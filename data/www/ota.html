<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>K2UartBriage - OTA Update</title>
  <link rel="stylesheet" href="/app.css">
  <style>
    /* OTA-only bits */
    .bar{ height:16px; border:1px solid var(--k2-border); border-radius:999px; overflow:hidden; background:#0B1118; margin-top:12px; }
    .fill{ height:100%; width:0%; background:var(--k2-accent); }
    pre{
      border:1px solid var(--k2-border);
      border-radius:12px;
      padding:12px;
      height:220px;
      overflow:auto;
      white-space:pre-wrap;
      margin-top:12px;
      background:#070B10;
      color:#D7E3F1;
      font-family:var(--font-mono);
      font-size:13px;
    }
    .k2-row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:10px; }
    .k2-row > *{ flex:1; }
  </style>
</head>
<body>

  <div class="k2-topbar">
    <div class="k2-toprow">
      <div class="k2-brand">
        <b id="appName">K2UartBriage - OTA Update</b>
        <span id="subTitle">UART Rescue / Firmware Utilities / Diagnostics</span>
        <span class="small" style="margin-top:4px">
          Host: <code id="hostName">...</code>
        </span>
      </div>
      <div id="st" class="k2-pill"><div class="k2-dot"></div><span>idle</span></div>
    </div>

    <div class="k2-subrow">
      <div id="navTabs" class="k2-tabs">
        <a class="k2-tab" href="/#rescue">UART Rescue</a>
        <a class="k2-tab" href="/#fw">Firmware Utilities</a>
        <a class="k2-tab" href="/#diag">Diagnostics</a>
        <a class="k2-tab" href="/console">Console</a>
      </div>

      <div class="small">
        Upload a <span class="mono">.bin</span> firmware. Progress polls <span class="mono">/api/status</span>.
      </div>
    </div>
  </div>

  <div class="k2-wrap">
    <div class="k2-card">
      <div class="k2-row" style="margin-top:0">
        <input id="fw" class="k2-input" type="file" accept=".bin,application/octet-stream"/>
        <button id="btn" class="k2-btn primary" onclick="doUpload()">Upload</button>
        <a href="/"><button class="k2-btn ghost" type="button">Back</button></a>
      </div>

      <div class="bar"><div id="fill" class="fill"></div></div>
      <div id="pct" class="small" style="margin-top:6px">0%</div>

      <pre id="log"></pre>
    </div>
  </div>

  <script src="/app.js"></script>
  <script>
    loadHeaderModels().then(()=>{});
    initOtaPage();
  </script>
</body>
</html>